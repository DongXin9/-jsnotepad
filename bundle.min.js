var $menubar=function(){var f,u=$('<div class="notepad-menubar"></div>'),p=[],h=-1;return{show:function(t){f=t;for(var e=$('<ul class="menu-title"></ul>'),l=0;l<f.length;l++){var n=$('<li class="title"></li>');n.html(f[l].title),n.attr("data-id",l),e.append(n),n.click(function(t){var e=Number(this.dataset.id);h=-1===h?(p[e].css({display:"inline-block"}),e):h!==e?(p[h].css({display:"none"}),p[e].css({display:"inline-block"}),e):(p[h].css({display:"none"}),-1),t.stopPropagation()}),n.hover(function(){if(-1!==h){var t=Number(this.dataset.id);p[h].css({display:"none"}),p[t].css({display:"inline-block"}),h=t}})}u.append(e);for(var i=0;i<f.length;i++){for(var s=$('<ul class="menus"></ul>'),o=f[i].menuItems,a=0;a<o.length;a++)if("hr"!==o[a].title){var c=$('<li class="menu-item"></li>');if(c.html(o[a].title),c.attr("data-x",i),c.attr("data-y",a),""!==o[a].shortcut){var d=$('<span class="shortcut"></span>');d.html(o[a].shortcut),c.append(d)}o[a].enabled||c.addClass("disabled"),s.append(c),c.click(function(t){if(t.stopPropagation(),!$(this).hasClass("disabled")){var e=this.dataset.x,l=this.dataset.y;p[e].css({display:"none"}),h=-1,f[e].menuItems[l].handler()}})}else{var r=$('<li class="menu-hr"></li>');s.append(r)}s.css({width:f[i].width,left:f[i].left,display:"none"}),u.append(s),p.push(s)}$("body").append(u)},hideMenu:function(){-1!==h&&(p[h].css({display:"none"}),h=-1)}}}(),$editor=function(){var e=$('<div class="notepad-editor"><textarea spellcheck="false" auto-size="none"></textarea></div>'),l=e.find("textarea"),n={posHandler:null,contentHandler:null,wrap:!1};function i(t){t?(l.attr("wrap","soft"),l.css({"overflow-x":"hidden"})):(l.attr("wrap","off"),l.css({"overflow-x":"scroll"}))}return{show:function(t){$.extend(n,t),$("body").append(e),l.trigger("focus"),i(n.wrap)},resize:function(t){t?e.css({bottom:"21px"}):e.css({bottom:"0"})},focus:function(){l.focus()},getTotalLn:function(){return l.val().split("\n").length},setWrap:i,setFont:function(t){l.css({"font-family":t.family,"font-size":t.size+"pt"}),"斜体"!==t.style?"粗体"!==t.style?"粗偏斜体"!==t.style?"常规"!==t.style||l.css({"font-weight":"normal","font-style":"normal"}):l.css({"font-weight":"bold","font-style":"italic"}):l.css({"font-weight":"bold","font-style":"normal"}):l.css({"font-style":"italic","font-weight":"normal"})},selectAll:function(){var t=l.val().length;l[0].selectionStart=0,l[0].selectionEnd=t,l.select()}}}(),$dlgAbout=function(){var t=$('<div class="notepad-dlg-mask notepad-dlg-about"><div class="dialogbox notepad-dlgbox"><div class="notepad-dlg-titlebar"><p class="title">关于“记事本”</p><span class="close-btn" title="关闭">✖</span></div><div class="main notepad-dlg-main"><h1 class="slogan">JSNotepad</h1><hr><div class="info"><p>作者：董心</p><p>QQ：2627405095</p><p>仓库地址：<a href="https://github.com/DongXin9/jsnotepad/" target="_blank">https://github.com/DongXin9/jsnotepad/</a></p></div><input class="btn-ok btn" type="button" value="确定" autofocus></div></div></div>'),e=t.find(".btn-ok"),l=t.find(".close-btn"),n=t.find(".notepad-dlg-titlebar");function i(){t.remove()}return{show:function(){$("body").append(t),t.find(".dialogbox").draggable({handle:n}),e.focus(),e.click(i),l.click(i),t.click(function(t){e.focus(),t.stopPropagation()})}}}();function comList(){var i,l=$('<div class="notepad-com-list"><input class="editor" type="text"><br><ul class="list"></ul></div>'),n=l.find(".editor"),s=l.find(".list"),o={container:"",list:[],select:0,width:"200px",isFont:!1,isFontStyle:!1,selectHandler:null};function e(){var t,e=$(o.container).find(".notepad-com-list");0!==e.length&&e.remove(),$(o.container).append(l),l.css({width:o.width}),function(){var t,e,l,n=0;if(o.isFont)for(n=0;n<o.list.length;n++)(t=$('<li class="item"></li>')).css({"font-family":o.list[n]}),s.append(t.html(o.list[n]));else if(o.isFontStyle)for(n=0;n<o.list.length;n++)t=$('<li class="item"></li>'),e=t,"斜体"!==(l=o.list[n])?"粗体"!==l?"粗偏斜体"!==l?"常规"!==o.style||e.css({"font-style":"normal","font-weight":"normal"}):e.css({"font-weight":"bold","font-style":"italic"}):e.css({"font-weight":"bold"}):e.css({"font-style":"italic"}),s.append(t.html(o.list[n]));else for(n=0;n<o.list.length;n++)t=$('<li class="item"></li>'),s.append(t.html(o.list[n]));i=s.find(".item")}(),t=o.select,$(i[t]).addClass("selected"),n.val(o.list[t]),n.select()}this.show=function(t){$.extend(o,t),e(),s.click(function(t){$(i[o.select]).removeClass("selected"),o.select=o.list.indexOf($(t.target).html()),$(i[o.select]).addClass("selected"),n.val(o.list[o.select]),n.select(),o.selectHandler(o.select)}),n.keyup(function(){var t=0;for(t=0;t<o.list.length&&0!==o.list[t].indexOf(n.val());t++);t!==o.list.length&&(i[t].scrollIntoView({behavior:"smooth",block:"start"}),$(i[o.select]).removeClass("selected"),$(i[t]).addClass("selected"),o.select=t)})}}var $dlgFont=function(){var e=$('<div class="notepad-dlg-mask notepad-dlg-font"><div class="dialogbox notepad-dlgbox"><div class="notepad-dlg-titlebar"><p class="title">字体</p><span class="close-btn" title="关闭">✖</span></div><div class="main notepad-dlg-main"><div class="font-family"><p>字体(F):</p></div><div class="font-style"><p>字形(Y):</p></div><div class="font-size"><p>大小(S):</p></div><fieldset class="sample"><legend>示例</legend><p class="sample-txt">AaBbYyZz</p></fieldset><div class="script"><label>脚本(R):<br><select><option value="西欧语言">西欧语言</option><option value="中文 GB2312">中文 GB2312</option></select></label></div><input class="btn-ok btn" type="button" value="确定"><input class="btn-cancel btn" type="button" value="取消"></div></div></div>'),l=e.find(".btn-ok"),n=e.find(".close-btn"),i=e.find(".btn-cancel"),t=e.find(".sample-txt"),s=e.find(".notepad-dlg-titlebar"),o=["Agency FB","Algerian","Arial","Arial Rounded MT","Axure Handwriting","Bahnschrift","Baskerville Old Face","Bauhaus 93","Bell MT","Berlin Sans FB","Bernard MT","BlackAdder ITC"],a=["常规","斜体","粗体","粗偏斜体"],c=["8","9","10","11","12","14","16","18","20","22","24","26","28","36","48","72"],d={family:"Arial",style:"常规",size:"16",okHandler:null};function r(){t.css({"font-family":d.family,"font-size":d.size+"pt"}),"斜体"!==d.style?"粗体"!==d.style?"粗偏斜体"!==d.style?"常规"!==d.style||t.css({"font-style":"normal","font-weight":"normal"}):t.css({"font-weight":"bold","font-style":"italic"}):t.css({"font-weight":"bold","font-style":"normal"}):t.css({"font-style":"italic","font-weight":"normal"})}function f(){e.remove()}return{show:function(t){$.extend(d,t),$("body").append(e),(new comList).show({container:".notepad-dlg-font .font-family",width:"176px",list:o,select:o.indexOf(d.family),isFont:!0,selectHandler:function(t){d.family=o[t],r()}}),(new comList).show({container:".notepad-dlg-font .font-style",width:"132px",list:a,select:a.indexOf(d.style),isFontStyle:!0,selectHandler:function(t){d.style=a[t],r()}}),(new comList).show({container:".notepad-dlg-font .font-size",width:"64px",list:c,select:c.indexOf(d.size),selectHandler:function(t){d.size=c[t],r()}}),r(),e.find(".dialogbox").draggable({handle:s}),n.click(f),i.click(f),l.click(function(){d.okHandler({family:d.family,style:d.style,size:d.size}),f()}),e.click(function(t){t.stopPropagation()})}}}(),np={config:{appContainer:".notepad-app"},fontFamily:"Arial",fontStype:"常规",fontSize:"16",fontHandler:function(t){np.fontFamily=t.family,np.fontStype=t.style,np.fontSize=t.size,$editor.setFont(t)}};np.menuData=[{title:"文件(F)",menuItems:[{title:"新建(N)",shortcut:"Ctrl+N",enabled:!0,handler:function(){console.log("新建(N) menu clicked!")}},{title:"打开(O)...",shortcut:"Ctrl+O",enabled:!0,handler:function(){console.log("打开(O) menu clicked!")}},{title:"保存(S)",shortcut:"Ctrl+S",enabled:!0,handler:function(){console.log("保存(S) menu clicked!")}},{title:"另存为(A)...",shortcut:"",enabled:!0,handler:function(){console.log("另存为(A) menu clicked!")}},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"页面设置(U)...",shortcut:"",enabled:!0,handler:function(){console.log("页面设置(U) menu clicked!")}},{title:"打印(P)...",shortcut:"Ctrl+P",enabled:!0,handler:function(){console.log("打印(P) menu clicked!")}},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"退出(X)",shortcut:"",enabled:!0,handler:function(){console.log("退出(X) menu clicked!")}}],width:"202px",left:"0px"},{title:"编辑(E)",menuItems:[{title:"撤销(U)",shortcut:"Ctrl+Z",enabled:!1,handler:function(){console.log("撤销(U) menu clicked!")}},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"剪切(T)",shortcut:"Ctrl+X",enabled:!0,handler:function(){console.log("剪切(X) menu clicked!")}},{title:"复制(C)",shortcut:"Ctrl+C",enabled:!1,handler:function(){console.log("复制(C) menu clicked!")}},{title:"粘贴(P)",shortcut:"Ctrl+V",enabled:!1,handler:function(){console.log("粘贴(P) menu clicked!")}},{title:"删除(L)",shortcut:"Del",enabled:!1,handler:function(){console.log("删除(L) menu clicked!")}},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"使用 Bing 搜索...",shortcut:"Ctrl+E",enabled:!0,handler:function(){console.log("使用 Bing 搜索...")}},{title:"查找(F)...",shortcut:"Ctrl+F",enabled:!0,handler:null},{title:"查找下一个(N)",shortcut:"F3",enabled:!1,handler:function(){console.log("查找下一个(N) menu clicked!")}},{title:"替换(R)...",shortcut:"Ctrl+H",enabled:!1,handler:function(){console.log("替换")}},{title:"转到(G)...",shortcut:"Ctrl+G",enabled:!0,handler:null},{title:"hr",shortcut:"",enabled:!0,handler:null},{title:"全选(A)",shortcut:"Ctrl+A",enabled:!0,handler:function(){$editor.selectAll()}},{title:"时间/日期(D)",shortcut:"F5",enabled:!0,handler:null}],width:"218px",left:"52px"},{title:"格式(O)",menuItems:[{title:"自动换行(W)",shortcut:"",enabled:!0,handler:null},{title:"字体(F)...",shortcut:"",enabled:!0,handler:function(){$dlgFont.show({family:np.fontFamily,style:np.fontStyle,size:np.fontSize,okHandler:np.fontHandler})}}],width:"156px",left:"106px"},{title:"查看(V)",menuItems:[{title:"状态栏(S)",shortcut:"",enabled:!0,handler:null}],width:"138px",left:"162px"},{title:"帮助(H)",menuItems:[{title:"查看帮助(H)",shortcut:"",enabled:!0,handler:function(){window.open("https://cn.bing.com/search?q=获取有关+windows+10+中的记事本的帮助","_blank")}},{title:"关于记事本(A)",shortcut:"",enabled:!0,handler:function(){$dlgAbout.show()}}],width:"166px",left:"216px"}],$(function(){$menubar.show(np.menuData),$editor.show(),$editor.setFont({family:np.fontFamily,style:np.fontStype,size:np.fontSize}),$("body").click(function(){$menubar.hideMenu(),$editor.focus()})});